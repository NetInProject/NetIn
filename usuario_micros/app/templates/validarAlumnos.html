{% extends "headerAdmin.html" %}

{% block content %}
<h1>Alumnos pendientes a validar</h1>
<div id="usuarios-container">
    {% if users %}
        {% for user in users %}
            <div class="usuario" id="usuario-{{ user.id }}">
                <li>{{ user.nombre }} {{ user.ap_paterno }} {{ user.ap_materno }}</li>
                <div>
                    <embed src="{{ url_for('static', filename='pdf/' + user.estudiante_pdf[14:]) }}" type="application/pdf" width="50%" height="500px"></embed>
                </div>
                <button class="btn-validar" data-id="{{ user.id }}">Siguiene Alumno</button>
                <button class="btn-actualizar" data-id="{{ user.id }}">Validar Alumno</button>
            </div>
        {% endfor %}
    {% else %}
        <p>No hay alumnos por validar.</p>
    {% endif %}
</div>
<script>
    // Ocultar todos los usuarios excepto el primero
    var usuarios = document.querySelectorAll('.usuario');
    for (var i = 1; i < usuarios.length; i++) {
        usuarios[i].style.display = 'none';
    }

    // Asignar evento clic a todos los botones
    var botonesValidar = document.querySelectorAll('.btn-validar');
    botonesValidar.forEach(function(botón) {
        botón.addEventListener('click', function() {
            var usuarioId = botón.dataset.id;
            var usuarioActual = document.getElementById('usuario-' + usuarioId);
            var siguienteUsuario = usuarioActual.nextElementSibling;
            if (siguienteUsuario) {
                usuarioActual.style.display = 'none';
                siguienteUsuario.style.display = 'block';
            } else {
                usuarioActual.style.display = 'none';
                usuarios[0].style.display = 'block';
            }
        });
    });

    var botonesActualizar = document.querySelectorAll('.btn-actualizar');
    botonesActualizar.forEach(function(botón) {
        botón.addEventListener('click', function() {
            var usuarioId = botón.dataset.id;
            actualizarUsuario(usuarioId);
        });
    });

    function actualizarUsuario(usuarioId) {
        // Enviar una solicitud al servidor para actualizar el campo "aprobado" del usuario
        fetch('/actualizar-usuario/' + usuarioId, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ aprobado: 1 })
        })
            .then(function(response) {
                if (response.ok) {
                    console.log('Usuario actualizado correctamente.');
                } else {
                    console.log('Error al actualizar el usuario.');
                }
            })
            .catch(function(error) {
                console.log('Error en la solicitud: ' + error.message);
            });
            setTimeout(function() {
                window.location.reload();
            }, 500);
    }
</script>
{% endblock %}
